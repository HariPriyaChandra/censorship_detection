{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":1845,"status":"ok","timestamp":1649832597638,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"7xfChdarIkSv"},"outputs":[],"source":["from tqdm.notebook import tqdm\n","import codecs\n","import pandas as pd\n","tqdm.pandas()\n","import string\n","from multiprocessing import  Pool\n","import numpy as np\n","import random"]},{"cell_type":"markdown","metadata":{"id":"KIW6Kd2tYCHP"},"source":["# parallelising Dataframe"]},{"cell_type":"code","execution_count":2,"metadata":{"executionInfo":{"elapsed":21,"status":"ok","timestamp":1649832597642,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"ELhP1LlpYB5E"},"outputs":[],"source":["def parallelize_dataframe(df, func, n_cores=2):\n","    df_split = np.array_split(df, n_cores)\n","    pool = Pool(n_cores)\n","    df = pd.concat(pool.map(func, df_split))\n","    pool.close()\n","    pool.join()\n","    return df"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3423,"status":"ok","timestamp":1649832604125,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"ydc3RLkaHJnW","outputId":"4c4e1daa-381f-4393-e1b1-febdd8f7009e"},"outputs":[{"name":"stdout","output_type":"stream","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["from google.colab import drive\n","import os\n","drive.mount('/content/drive')\n","os.chdir(\"./drive/MyDrive/NLP Project\")"]},{"cell_type":"markdown","metadata":{"id":"2mNqgavMHBLy"},"source":["# data Download"]},{"cell_type":"code","execution_count":3,"metadata":{"executionInfo":{"elapsed":457,"status":"ok","timestamp":1649823114019,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"dAA2MRSqHA-x"},"outputs":[],"source":["# !unzip  \"/content/drive/MyDrive/NLP Project/1.zip\" -d \"/content/drive/MyDrive/NLP Project/unzipData/\"\n","# datafolder=os.listdir(\"./unzipData/\")\n","# import os, zipfile\n","\n","# # dir_name = 'C:\\\\SomeDirectory'\n","# extension = \".zip\"\n","\n","# # os.chdir(dir_name) # c?hange directory from working dir to dir with files?\n","\n","# for item in datafolder: # loop through items in dir\n","#     if item.endswith(extension): # check for \".zip\" extension\n","#         zip_ref = zipfile.ZipFile(\"./unzipData/\"+item) # create zipfile object\n","#         zip_ref.extractall(\"./FinalDataset\") # extract file to dir\n","#         zip_ref.close() # close file"]},{"cell_type":"markdown","metadata":{"id":"-hFuoL5RHXQf"},"source":["# install required packages"]},{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4396,"status":"ok","timestamp":1649823126013,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"up8ErLLl2Syv","outputId":"e686f978-6c10-4dba-cda3-2faf442a2fb9"},"outputs":[{"name":"stdout","output_type":"stream","text":["Collecting demoji\n","  Downloading demoji-1.1.0-py3-none-any.whl (42 kB)\n","\u001b[?25l\r\u001b[K     |███████▋                        | 10 kB 24.3 MB/s eta 0:00:01\r\u001b[K     |███████████████▎                | 20 kB 27.6 MB/s eta 0:00:01\r\u001b[K     |███████████████████████         | 30 kB 20.8 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▋ | 40 kB 13.0 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 42 kB 987 kB/s \n","\u001b[?25hInstalling collected packages: demoji\n","Successfully installed demoji-1.1.0\n"]}],"source":["!pip install demoji"]},{"cell_type":"markdown","metadata":{"id":"91aDP9pWHTyz"},"source":["#loading embedders"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":5253,"status":"ok","timestamp":1649823134625,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"-14taviZ9Eap"},"outputs":[],"source":["from embedder import GoogleUniversalSentenceEncoder"]},{"cell_type":"code","execution_count":6,"metadata":{"executionInfo":{"elapsed":17922,"status":"ok","timestamp":1649823154765,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"h0Bbqq5j9Yoo"},"outputs":[],"source":["guse = GoogleUniversalSentenceEncoder()"]},{"cell_type":"markdown","metadata":{"id":"C06qwLT-G4eY"},"source":["# preprocessing functions"]},{"cell_type":"code","execution_count":4,"metadata":{"executionInfo":{"elapsed":565,"status":"ok","timestamp":1649832610783,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"WZ42ixPB9c4f"},"outputs":[],"source":["import string\n","import re\n","import demoji\n","def preprocessText(text):\n","  text = str(text)\n","  # remove url from text\n","  text = re.sub(r'http\\S+', '', text)\n","  # remove the punctuations and emojis from the text\n","  # text = emoji.replace_emoji(text, '')\n","  text = demoji.replace(text,\"\")\n","  # text = \"\".join([c for c in text if c not in string.punctuation])\n","  text=str(text).translate(str.maketrans('','',string.punctuation))\n","  return text\n","\n","def preprocessDF(df):\n","  df=df.loc[:,[\"mid\",\"text\",\"created_at\",\"deleted_last_seen\",\"permission_denied\"]].fillna(False)\n","  return df"]},{"cell_type":"markdown","metadata":{"id":"w6GpzhD6Gk_r"},"source":["# encode and save to solve issue of the utf8 read error"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":476,"status":"ok","timestamp":1649832615628,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"rST29ecq_Z90"},"outputs":[],"source":["# for csv in tqdm(os.listdir(\"./FinalDataset/\")):\n","#   with codecs.open(\"./FinalDataset/\"+csv, 'r', encoding='utf-8',errors='ignore') as fdata:\n","#     csvData=fdata.read()\n","#   with open(\"./encodedDatasetV2/\"+\"p_\"+csv, 'w', encoding='utf8') as f:\n","#     f.write(csvData)\n","\n","# del csvData\n","# del f"]},{"cell_type":"markdown","metadata":{"id":"MlKi-bjWJWI_"},"source":["# find all the censored data"]},{"cell_type":"code","execution_count":8,"metadata":{"executionInfo":{"elapsed":654,"status":"ok","timestamp":1649832821187,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"Rvc-8GWQKlzJ"},"outputs":[],"source":["def getDataSplit(df):\n","  df_censored=df.loc[df[\"permission_denied\"]==True]\n","  df_not_censored=df.loc[df[\"permission_denied\"]==False]\n","  return df_censored,df_not_censored"]},{"cell_type":"code","execution_count":8,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1649832822085,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"HGznBY41YWIX"},"outputs":[],"source":[""]},{"cell_type":"code","execution_count":9,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1649832822639,"user":{"displayName":"Edwin Jose","userId":"08512034229086733421"},"user_tz":-330},"id":"vrpp8xWxYUnS"},"outputs":[],"source":["def parallelPreprocess(df):\n","  df[\"text\"] = df[\"text\"].progress_apply(lambda x:preprocessText(str(x)))\n","  return df"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/","height":84},"id":"gQ7BFjA7JVvd"},"outputs":[{"data":{"application/vnd.jupyter.widget-view+json":{"model_id":"96177ec2251042f186266e12849df4b9","version_major":2,"version_minor":0},"text/plain":["  0%|          | 0/20 [00:00\u003c?, ?it/s]"]},"metadata":{},"output_type":"display_data"},{"name":"stderr","output_type":"stream","text":["/usr/local/lib/python3.7/dist-packages/IPython/core/interactiveshell.py:2882: DtypeWarning: Columns (10) have mixed types.Specify dtype option on import or set low_memory=False.\n","  exec(code_obj, self.user_global_ns, self.user_ns)\n"]}],"source":["data_folder=\"./encodedDatasetV2/\"\n","for csv in tqdm(os.listdir(\"./encodedDatasetV2\")[:20]):\n","  df=pd.read_csv(data_folder+csv,usecols=[\"mid\",\"text\",\"created_at\",\"deleted_last_seen\",\"permission_denied\"])\n","  df_clean=preprocessDF(df)\n","  del df\n","  df_clean = parallelize_dataframe(df = df_clean, func = parallelPreprocess )\n","  df_censored,df_not_censored = getDataSplit(df_clean)\n","  df_censored.to_csv('./splitData/censored.csv', mode='a', index=False, header=False)\n","  df_not_censored.to_csv('./splitData/not_censored.csv', mode='a', index=False, header=False)\n","  del df_censored\n","  del df_not_censored\n","  del df_clean\n","  \n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ScxWdl7IQrp-"},"outputs":[],"source":[""]}],"metadata":{"colab":{"collapsed_sections":[],"name":"NLP Full","toc_visible":true,"version":""},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"24b28dc2a4c2448c8b3413476b65a780":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4f617313969242fb866bc710c1faedff":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5dd77bfaaa15469b8f22ab3641f04444":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8ab56ff96d2744898319dcb746d09b47":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_a4e2bc23a4f5465cb517bafa3f2d8ffc","max":20,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4f617313969242fb866bc710c1faedff","value":6}},"96177ec2251042f186266e12849df4b9":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_fa906369c84646ac8ab6d8f0f928c4f1","IPY_MODEL_8ab56ff96d2744898319dcb746d09b47","IPY_MODEL_cdd48653096741e68bd3b74d0d604611"],"layout":"IPY_MODEL_c60fbd58c7a14dac962e00bc2efed5b5"}},"a4e2bc23a4f5465cb517bafa3f2d8ffc":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c60fbd58c7a14dac962e00bc2efed5b5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c9aad64ad90d4c02a1a51c6e98b0c2ce":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cdd48653096741e68bd3b74d0d604611":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_feb78a2a06164bc3ad8d5a3516a7a4dd","placeholder":"​","style":"IPY_MODEL_24b28dc2a4c2448c8b3413476b65a780","value":" 6/20 [2:00:06\u0026lt;4:29:28, 1154.88s/it]"}},"fa906369c84646ac8ab6d8f0f928c4f1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5dd77bfaaa15469b8f22ab3641f04444","placeholder":"​","style":"IPY_MODEL_c9aad64ad90d4c02a1a51c6e98b0c2ce","value":" 30%"}},"feb78a2a06164bc3ad8d5a3516a7a4dd":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}}}}},"nbformat":4,"nbformat_minor":0}